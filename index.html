<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/style.css">
  <title>–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä –ë—û–π–∏—á–∞ “≤–∏—Å–æ–±–æ—Ç</title>

  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jsPDF@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä –ë—û–π–∏—á–∞ “≤–∏—Å–æ–±–æ—Ç</h1>
  
  <div class="container">
    <h2>üìç “≤—É–¥—É–¥–ª–∞—Ä</h2>
    <select id="regionSelect">
      <option value="–†–µ—Å–ø—É–±–ª–∏–∫–∞">–é–∑–±–µ–∫–∏—Å—Ç–æ–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å–∏ –∏“õ—Ç–∏—Å–æ–¥–∏—ë—Ç –≤–∞ –º–æ–ª–∏—è –≤–∞–∑–∏—Ä–ª–∏–≥–∏ “≥—É–∑–∏—Ä–∏–¥–∞–≥–∏ –ë–æ–∂—Ö–æ–Ω–∞ “õ—û–º–∏—Ç–∞—Å–∏</option>
      <option value="toshkent">–¢–æ—à–∫–µ–Ω—Ç —à–∞—Ö–∞—Ä –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="—Å–∞–º–∞—Ä–∫–∞–Ω–¥">–°–∞–º–∞—Ä“õ–∞–Ω–¥ –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="–±—É—Ö–æ—Ä–æ">–ë—É—Ö–æ—Ä–æ –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="–Ω–∞–º–∞–Ω–≥–∞–Ω">–ù–∞–º–∞–Ω–≥–∞–Ω –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="—Ñ–∞—Ä–≥–æ–Ω–∞">–§–∞—Ä“ì–æ–Ω–∞ –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="–∞–Ω–¥–∏–∂–∞–Ω">–ê–Ω–¥–∏–∂–æ–Ω –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="—Ö–∏–≤–∞">–•–æ—Ä–∞–∑–º –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="—Å—É—Ä—Ö–∞–Ω–¥–∞—Ä—ë">–°—É—Ä—Ö–∞–Ω–¥–∞—Ä—ë –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="–Ω–∞–≤–æ–∏">–ù–∞–≤–æ–∏–π –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="–∫–∞—à–∫–∞–¥–∞—Ä—ë">“ö–∞—à“õ–∞–¥–∞—Ä—ë –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="—Å–∏–∑–∑">–°–∏—Ä–¥–∞—Ä—ë –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="–∂–∏–∑–∑–∞—Ö">–ñ–∏–∑–∑–∞—Ö –≤–∏–ª–æ—è—Ç–∏ –ë–æ–∂—Ö–æ–Ω–∞ –±–æ—à“õ–∞—Ä–º–∞—Å–∏</option>
      <option value="–ê—ç—Ä–æ">–¢–æ—à–∫–µ–Ω—Ç-–ê—ç—Ä–æ</option>
      <option value="–ö–∏–Ω–æ–ª–æ–≥–∏—è">–ú–∏–ª–ª–∏–π –∫–∏–Ω–æ–ª–æ–≥–∏—è –º–∞—Ä–∫–∞–∑–∏</option>
    </select>

    <h2>üìÖ –ô–∏–ª–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥:</h2>
    <select id="yearSelect">
      <option value="2025">2025</option>
      <option value="2024">2024</option>
      <option value="2023">2023</option>
      <option value="2022">2022</option>
      <option value="2021">2021</option>
    </select>

    <h2>üìÖ –û–π–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥:</h2>
    <select id="monthSelect">
      <option value="yanvar">–Ø–Ω–≤–∞—Ä</option>
      <option value="fevral">–§–µ–≤—Ä–∞–ª</option>
      <option value="mart">–ú–∞—Ä—Ç</option>
      <option value="aprel">–ê–ø—Ä–µ–ª</option>
      <option value="may">–ú–∞–π</option>
      <option value="iyun">–ò—é–Ω</option>
      <option value="iyul">–ò—é–ª</option>
      <option value="avgust">–ê–≤–≥—É—Å—Ç</option>
      <option value="sentabr">–°–µ–Ω—Ç—è–±—Ä</option>
      <option value="oktabr">–û–∫—Ç—è–±—Ä</option>
      <option value="noyabr">–ù–æ—è–±—Ä</option>
      <option value="dekabr">–î–µ–∫–∞–±—Ä</option>
    </select>
    
    <h3>–ú–∞–ª—É–º–æ—Ç–ª–∞—Ä–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥:</h3>
    <div class="grid">
      <div><label>–ñ–∏—Å–º–æ–Ω–∏–π —à–∞—Ö—Å–ª–∞—Ä</label><input type="number" id="individual" oninput="calculateTotal()" /></div>
      <div><label>–Æ—Ä–∏–¥–∏–∫ —à–∞—Ö—Å–ª–∞—Ä</label><input type="number" id="legal" oninput="calculateTotal()" /></div>
      <div><label>–Å–∑–º–∞</label><input type="number" id="written" oninput="calculateTotal()" /></div>
      <div><label>–≠–ª–µ–∫—Ç—Ä–æ–Ω</label><input type="number" id="electronic" oninput="calculateTotal()" /></div>
      <div><label>–û“ì–∑–∞–∫–∏</label><input type="number" id="oral" oninput="calculateTotal()" /></div>
    </div>

    <h3>–ñ–∞–º–∏ –º—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä: <span id="totalCount">0</span></h3>
    
    <br>
    <button onclick="saveData()">üíæ –°–∞“õ–ª–∞—à</button>
    <button onclick="downloadPDF()">üìÑ –Æ–∫–ª–∞–± –æ–ª–∏—à (PDF)</button>
  </div>

  <div class="container">
    <h2>üìä –¢–∞–Ω–ª–∞–Ω–≥–∞–Ω –æ–π –±—û–π–∏—á–∞ –≥—Ä–∞—Ñ–∏–∫</h2>
    <canvas id="monthlyChart"></canvas>
  </div>

  <div class="container">
    <h2>üìä –ô–∏–ª–ª–∏–∫ —É–º—É–º–∏–π –≥—Ä–∞—Ñ–∏–∫</h2>
    <canvas id="yearlyChart"></canvas>
  </div>

  <script>
    const inputs = {
      individual: document.getElementById("individual"),
      legal: document.getElementById("legal"),
      written: document.getElementById("written"),
      electronic: document.getElementById("electronic"),
      oral: document.getElementById("oral")
    };
    const totalCount = document.getElementById("totalCount");

    // Oylik chart
    const monthlyCtx = document.getElementById("monthlyChart").getContext("2d");
    let monthlyChart = new Chart(monthlyCtx, {
      type: "bar",
      data: {
        labels: ["–ñ–∏—Å–º–æ–Ω–∏–π", "–Æ—Ä–∏–¥–∏–∫", "–Å–∑–º–∞", "–≠–ª–µ–∫—Ç—Ä–æ–Ω", "–û“ì–∑–∞–∫–∏"],
        datasets: [{ label: "–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä", data: [0,0,0,0,0], backgroundColor: ["#0099cc","#00bbaa","#33cc77","#99cc00","#ff9933"], borderRadius: 5 }]
      },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    // Yillik chart
    const yearlyCtx = document.getElementById("yearlyChart").getContext("2d");
    let yearlyChart = new Chart(yearlyCtx, {
      type: "bar",
      data: {
        labels: ["–Ø–Ω–≤","–§–µ–≤","–ú–∞—Ä","–ê–ø—Ä","–ú–∞–π","–ò—é–Ω","–ò—é–ª","–ê–≤–≥","–°–µ–Ω","–û–∫—Ç","–ù–æ—è","–î–µ–∫"],
        datasets: [{ label: "–ñ–∞–º–∏ –º—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä", data: Array(12).fill(0), backgroundColor: "#0077cc", borderRadius: 5 }]
      },
      options: { responsive: true, plugins:{legend:{display:false}}, scales: { y: { beginAtZero: true } } }
    });

    function getKey(region, year, month) {
      return `regionData_${region}_${year}_${month}`;
    }

    function saveData() {
      const region = regionSelect.value;
      const year = yearSelect.value;
      const month = monthSelect.value;
      const key = getKey(region, year, month);

      const data = {
        individual: +inputs.individual.value,
        legal: +inputs.legal.value,
        written: +inputs.written.value,
        electronic: +inputs.electronic.value,
        oral: +inputs.oral.value
      };

      localStorage.setItem(key, JSON.stringify(data));
      updateMonthlyChart(data);
      updateYearlyChart(year, region);
    }

    function loadData(region, year, month) {
      const key = getKey(region, year, month);
      const data = JSON.parse(localStorage.getItem(key)) || { individual:0, legal:0, written:0, electronic:0, oral:0 };

      inputs.individual.value = data.individual;
      inputs.legal.value = data.legal;
      inputs.written.value = data.written;
      inputs.electronic.value = data.electronic;
      inputs.oral.value = data.oral;

      updateMonthlyChart(data);
      updateYearlyChart(year, region);
      calculateTotal();
    }

    function updateMonthlyChart(data) {
      monthlyChart.data.datasets[0].data = [data.individual, data.legal, data.written, data.electronic, data.oral];
      monthlyChart.update();
    }

    function updateYearlyChart(year, region) {
      const months = ["yanvar","fevral","mart","aprel","may","iyun","iyul","avgust","sentabr","oktabr","noyabr","dekabr"];
      const totals = months.map(month => {
        const key = getKey(region, year, month);
        const d = JSON.parse(localStorage.getItem(key)) || { individual:0, legal:0, written:0, electronic:0, oral:0 };
        return d.individual + d.legal + d.written + d.electronic + d.oral;
      });
      yearlyChart.data.datasets[0].data = totals;
      yearlyChart.update();
    }

    function calculateTotal() {
      const total = +inputs.individual.value + +inputs.legal.value + +inputs.written.value + +inputs.electronic.value + +inputs.oral.value;
      totalCount.textContent = total;
    }

    regionSelect.addEventListener("change", () => loadData(regionSelect.value, yearSelect.value, monthSelect.value));
    yearSelect.addEventListener("change", () => loadData(regionSelect.value, yearSelect.value, monthSelect.value));
    monthSelect.addEventListener("change", () => loadData(regionSelect.value, yearSelect.value, monthSelect.value));

    window.onload = () => { loadData(regionSelect.value, yearSelect.value, monthSelect.value); };

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const region = regionSelect.value;
      const year = yearSelect.value;
      const month = monthSelect.value;

      doc.setFontSize(16);
      doc.text("–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä –ë—û–π–∏—á–∞ “≤–∏—Å–æ–±–æ—Ç", 20, 20);

      doc.setFontSize(12);
      doc.text(`–û–±–ª–∞—Å—Ç—å: ${region}`, 20, 30);
      doc.text(`–ô–∏–ª: ${year}`, 20, 40);
      doc.text(`–û–π: ${month}`, 20, 50);

      doc.text(`–ñ–∏—Å–º–æ–Ω–∏–π —à–∞—Ö—Å–ª–∞—Ä: ${inputs.individual.value}`, 20, 60);
      doc.text(`–Æ—Ä–∏–¥–∏–∫ —à–∞—Ö—Å–ª–∞—Ä: ${inputs.legal.value}`, 20, 70);
      doc.text(`–Å–∑–º–∞: ${inputs.written.value}`, 20, 80);
      doc.text(`–≠–ª–µ–∫—Ç—Ä–æ–Ω: ${inputs.electronic.value}`, 20, 90);
      doc.text(`–û“ì–∑–∞–∫–∏: ${inputs.oral.value}`, 20, 100);
      doc.text(`–ñ–∞–º–∏ –º—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä: ${totalCount.textContent}`, 20, 110);

      const canvas = document.getElementById('monthlyChart');
      const imgData = canvas.toDataURL("image/png");
      doc.addImage(imgData, 'PNG', 20, 120, 170, 80);

      const canvas2 = document.getElementById('yearlyChart');
      const imgData2 = canvas2.toDataURL("image/png");
      doc.addImage(imgData2, 'PNG', 20, 210, 170, 80);

      doc.save("report.pdf");
    }
  </script>
</body>
</html>
