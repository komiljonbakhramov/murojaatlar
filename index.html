<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/style.css">
  <title>–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä –ë—û–π–∏—á–∞ “≤–∏—Å–æ–±–æ—Ç</title>

</head>
<body>
  <h1>–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä –ë—û–π–∏—á–∞ “≤–∏—Å–æ–±–æ—Ç</h1>
  
  <div class="container">
    <h2>üìç –û–±–ª–∞—Å—Ç—å–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥:</h2>
    <select id="regionSelect">
      <option value="toshkent">–¢–æ—à–∫–µ–Ω—Ç</option>
      <option value="—Å–∞–º–∞—Ä–∫–∞–Ω–¥">–°–∞–º–∞—Ä“õ–∞–Ω–¥</option>
      <option value="–±—É—Ö–æ—Ä–æ">–ë—É—Ö–æ—Ä–æ</option>
      <option value="–Ω–∞–º–∞–Ω–≥–∞–Ω">–ù–∞–º–∞–Ω–≥–∞–Ω</option>
      <option value="—Ñ–∞—Ä–≥–æ–Ω–∞">–§–∞—Ä“ì–æ–Ω–∞</option>
      <option value="–∞–Ω–¥–∏–∂–∞–Ω">–ê–Ω–¥–∏–∂–æ–Ω</option>
      <option value="—Ö–∏–≤–∞">–•–æ—Ä–∞–∑–º</option>
      <option value="—Å—É—Ä—Ö–∞–Ω–¥–∞—Ä—ë">–°—É—Ä—Ö–∞–Ω–¥–∞—Ä—ë</option>
      <option value="–Ω–∞–≤–æ–∏">–ù–∞–≤–æ–∏–π</option>
      <option value="–∫–∞—à–∫–∞–¥–∞—Ä—ë">“ö–∞—à“õ–∞–¥–∞—Ä—ë</option>
      <option value="—Å–∏–∑–∑">–°–∏—Ä–¥–∞—Ä—ë</option>
      <option value="–∂–∏–∑–∑–∞—Ö">–ñ–∏–∑–∑–∞—Ö</option>
    </select>

    <h2>üìÖ –ô–∏–ª–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥:</h2>
    <select id="yearSelect">
      <option value="2024">2024</option>
      <option value="2023">2023</option>
      <option value="2022">2022</option>
      <option value="2021">2021</option>
    </select>
    
    <h3>–ú–∞–ª—É–º–æ—Ç–ª–∞—Ä–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥:</h3>
    <div class="grid">
      <div>
        <label>–ñ–∞–º–∏ –º—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä</label>
        <input type="number" id="total" />
      </div>
      <div>
        <label>–ñ–∏—Å–º–æ–Ω–∏–π —à–∞—Ö—Å–ª–∞—Ä</label>
        <input type="number" id="individual" />
      </div>
      <div>
        <label>–Æ—Ä–∏–¥–∏–∫ —à–∞—Ö—Å–ª–∞—Ä</label>
        <input type="number" id="legal" />
      </div>
      <div>
        <label>–Å–∑–º–∞</label>
        <input type="number" id="written" />
      </div>
      <div>
        <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω</label>
        <input type="number" id="electronic" />
      </div>
      <div>
        <label>–û“ì–∑–∞–∫–∏</label>
        <input type="number" id="oral" />
      </div>
    </div>
    <br>
    <button onclick="saveData()">üíæ –°–∞“õ–ª–∞—à</button>
    <button onclick="downloadPDF()">üìÑ –Æ–∫–ª–∞–± –æ–ª–∏—à (PDF)</button>
  </div>

  <div class="container">
    <h2>üìä –ì—Ä–∞—Ñ–∏–∫</h2>
    <canvas id="chart"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const { jsPDF } = window.jspdf;
    const inputs = {
      total: document.getElementById("total"),
      individual: document.getElementById("individual"),
      legal: document.getElementById("legal"),
      written: document.getElementById("written"),
      electronic: document.getElementById("electronic"),
      oral: document.getElementById("oral")
    };

    const ctx = document.getElementById("chart").getContext("2d");
    let chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["–ñ–∞–º–∏", "–ñ–∏—Å–º–æ–Ω–∏–π", "–Æ—Ä–∏–¥–∏–∫", "–Å–∑–º–∞", "–≠–ª–µ–∫—Ç—Ä–æ–Ω", "–û“ì–∑–∞–∫–∏"],
        datasets: [{
          label: "–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä",
          data: [0, 0, 0, 0, 0, 0],
          backgroundColor: ["#0077cc", "#0099cc", "#00bbaa", "#33cc77", "#99cc00", "#ff9933"]
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    function saveData() {
      const region = document.getElementById("regionSelect").value;
      const year = document.getElementById("yearSelect").value;
      const data = {
        total: +inputs.total.value,
        individual: +inputs.individual.value,
        legal: +inputs.legal.value,
        written: +inputs.written.value,
        electronic: +inputs.electronic.value,
        oral: +inputs.oral.value
      };
      localStorage.setItem(`regionData_${region}_${year}`, JSON.stringify(data));
      updateChart(data);
    }

    function updateChart(data) {
      chart.data.datasets[0].data = [
        data.total,
        data.individual,
        data.legal,
        data.written,
        data.electronic,
        data.oral
      ];
      chart.update();
    }

    function loadData(region, year) {
      const data = JSON.parse(localStorage.getItem(`regionData_${region}_${year}`)) || {
        total: 0,
        individual: 0,
        legal: 0,
        written: 0,
        electronic: 0,
        oral: 0
      };
      inputs.total.value = data.total;
      inputs.individual.value = data.individual;
      inputs.legal.value = data.legal;
      inputs.written.value = data.written;
      inputs.electronic.value = data.electronic;
      inputs.oral.value = data.oral;
      updateChart(data);
    }

    document.getElementById("regionSelect").addEventListener("change", (e) => {
      const year = document.getElementById("yearSelect").value;
      loadData(e.target.value, year);
    });

    document.getElementById("yearSelect").addEventListener("change", (e) => {
      const region = document.getElementById("regionSelect").value;
      loadData(region, e.target.value);
    });

    window.onload = () => {
      const initialRegion = document.getElementById("regionSelect").value;
      const initialYear = document.getElementById("yearSelect").value;
      loadData(initialRegion, initialYear);
    };

    function downloadPDF() {
      const doc = new jsPDF();

      doc.setFontSize(16);
      doc.text("–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä –ë—û–π–∏—á–∞ “≤–∏—Å–æ–±–æ—Ç", 20, 20);

      doc.setFontSize(12);
      doc.text(`–û–±–ª–∞—Å—Ç—å: ${document.getElementById("regionSelect").value}`, 20, 30);
      doc.text(`–ô–∏–ª: ${document.getElementById("yearSelect").value}`, 20, 40);
      doc.text(`–ñ–∞–º–∏ –º—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä: ${inputs.total.value}`, 20, 50);
      doc.text(`–ñ–∏—Å–º–æ–Ω–∏–π —à–∞—Ö—Å–ª–∞—Ä: ${inputs.individual.value}`, 20, 60);
      doc.text(`–Æ—Ä–∏–¥–∏–∫ —à–∞—Ö—Å–ª–∞—Ä: ${inputs.legal.value}`, 20, 70);
      doc.text(`–Å–∑–º–∞: ${inputs.written.value}`, 20, 80);
      doc.text(`–≠–ª–µ–∫—Ç—Ä–æ–Ω: ${inputs.electronic.value}`, 20, 90);
      doc.text(`–û“ì–∑–∞–∫–∏: ${inputs.oral.value}`, 20, 100);

      doc.addPage();
      doc.text("–ì—Ä–∞—Ñ–∏–∫", 20, 20);
      doc.addImage(chart.toBase64Image(), "PNG", 20, 30, 170, 120);

      doc.save(`murujatlar_–æ—Ç—á–µ—Ç_${document.getElementById("regionSelect").value}_${document.getElementById("yearSelect").value}.pdf`);
    }
  </script>
</body>
</html>
