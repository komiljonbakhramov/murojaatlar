<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/style.css">
  <title>–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä –ë—û–π–∏—á–∞ “≤–∏—Å–æ–±–æ—Ç</title>

  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jsPDF@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <h1>–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä –ë—û–π–∏—á–∞ “≤–∏—Å–æ–±–æ—Ç</h1>
  
  <!-- –î–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç–∞ -->
  <div class="container">
    <h2>üìç “≤—É–¥—É–¥–ª–∞—Ä</h2>
    <select id="regionSelect">
      <option value="toshkent">–¢–æ—à–∫–µ–Ω—Ç</option>
      <option value="—Å–∞–º–∞—Ä–∫–∞–Ω–¥">–°–∞–º–∞—Ä“õ–∞–Ω–¥</option>
      <option value="–±—É—Ö–æ—Ä–æ">–ë—É—Ö–æ—Ä–æ</option>
      <option value="–Ω–∞–º–∞–Ω–≥–∞–Ω">–ù–∞–º–∞–Ω–≥–∞–Ω</option>
      <option value="—Ñ–∞—Ä–≥–æ–Ω–∞">–§–∞—Ä“ì–æ–Ω–∞</option>
      <option value="–∞–Ω–¥–∏–∂–∞–Ω">–ê–Ω–¥–∏–∂–æ–Ω</option>
      <option value="—Ö–∏–≤–∞">–•–æ—Ä–∞–∑–º</option>
      <option value="—Å—É—Ä—Ö–∞–Ω–¥–∞—Ä—ë">–°—É—Ä—Ö–∞–Ω–¥–∞—Ä—ë</option>
      <option value="–Ω–∞–≤–æ–∏">–ù–∞–≤–æ–∏–π</option>
      <option value="–∫–∞—à–∫–∞–¥–∞—Ä—ë">“ö–∞—à“õ–∞–¥–∞—Ä—ë</option>
      <option value="—Å–∏–∑–∑">–°–∏—Ä–¥–∞—Ä—ë</option>
      <option value="–∂–∏–∑–∑–∞—Ö">–ñ–∏–∑–∑–∞—Ö</option>
    </select>

    <h2>üìÖ –ô–∏–ª–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥:</h2>
    <select id="yearSelect">
      <option value="2024">2024</option>
      <option value="2023">2023</option>
      <option value="2022">2022</option>
      <option value="2021">2021</option>
    </select>
    
    <h3>–ú–∞–ª—É–º–æ—Ç–ª–∞—Ä–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥:</h3>
    <div class="grid">
      <div>
        <label>–ñ–∏—Å–º–æ–Ω–∏–π —à–∞—Ö—Å–ª–∞—Ä</label>
        <input type="number" id="individual" oninput="calculateTotal()" />
      </div>
      <div>
        <label>–Æ—Ä–∏–¥–∏–∫ —à–∞—Ö—Å–ª–∞—Ä</label>
        <input type="number" id="legal" oninput="calculateTotal()" />
      </div>
      <div>
        <label>–Å–∑–º–∞</label>
        <input type="number" id="written" oninput="calculateTotal()" />
      </div>
      <div>
        <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω</label>
        <input type="number" id="electronic" oninput="calculateTotal()" />
      </div>
      <div>
        <label>–û“ì–∑–∞–∫–∏</label>
        <input type="number" id="oral" oninput="calculateTotal()" />
      </div>
    </div>

    <h3>–ñ–∞–º–∏ –º—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä: <span id="totalCount">0</span></h3>
    
    <br>
    <button onclick="saveData()">üíæ –°–∞“õ–ª–∞—à</button>
    <button onclick="downloadPDF()">üìÑ –Æ–∫–ª–∞–± –æ–ª–∏—à (PDF)</button>
  </div>

  <div class="container">
    <h2>üìä –ì—Ä–∞—Ñ–∏–∫</h2>
    <canvas id="chart"></canvas>
  </div>

  <div class="container">
    <h3>üìà –û–±—à–∏–∏–π –û—Ç—á–µ—Ç:</h3>
    <div id="regionSummary">
      <!-- –û–±—â–∏–π –æ—Ç—á–µ—Ç –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞ -->
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script>
    const inputs = {
      individual: document.getElementById("individual"),
      legal: document.getElementById("legal"),
      written: document.getElementById("written"),
      electronic: document.getElementById("electronic"),
      oral: document.getElementById("oral")
    };

    const totalCount = document.getElementById("totalCount");
    const ctx = document.getElementById("chart").getContext("2d");
    let chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: [
          "üë§ –ñ–∏—Å–º–æ–Ω–∏–π",
          "üè¢ –Æ—Ä–∏–¥–∏–∫",
          "üìù –Å–∑–º–∞",
          "üíª –≠–ª–µ–∫—Ç—Ä–æ–Ω",
          "üó£Ô∏è –û“ì–∑–∞–∫–∏"
        ],
        datasets: [{
          label: "–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä",
          data: [0, 0, 0, 0, 0],
          backgroundColor: [
            "#0099cc",
            "#00bbaa",
            "#33cc77",
            "#99cc00",
            "#ff9933"
          ],
          borderRadius: 5,
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
          legend: { display: false },
          datalabels: {
            color: '#000',
            anchor: 'end',
            align: 'right',
            font: { weight: 'bold' }
          }
        },
        scales: {
          x: { beginAtZero: true }
        }
      },
      plugins: [ChartDataLabels]
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
    function saveData() {
      const region = document.getElementById("regionSelect").value;
      const data = {
        individual: +inputs.individual.value,
        legal: +inputs.legal.value,
        written: +inputs.written.value,
        electronic: +inputs.electronic.value,
        oral: +inputs.oral.value
      };
      localStorage.setItem(`regionData_${region}`, JSON.stringify(data));
      updateChart(data);
      updateSummary(region, data);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
    function updateChart(data) {
      chart.data.datasets[0].data = [
        data.individual,
        data.legal,
        data.written,
        data.electronic,
        data.oral
      ];
      chart.update();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
    function loadData(region) {
      const data = JSON.parse(localStorage.getItem(`regionData_${region}`)) || {
        individual: 0,
        legal: 0,
        written: 0,
        electronic: 0,
        oral: 0
      };
      inputs.individual.value = data.individual;
      inputs.legal.value = data.legal;
      inputs.written.value = data.written;
      inputs.electronic.value = data.electronic;
      inputs.oral.value = data.oral;
      updateChart(data);
      updateSummary(region, data);
      calculateTotal();  // Ensure total is calculated
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –æ—Ç—á–µ—Ç–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
    function updateSummary(region, data) {
      const regionSummary = document.getElementById("regionSummary");
      regionSummary.innerHTML = ` 
        <p>üìç <strong>${region.charAt(0).toUpperCase() + region.slice(1)}</strong>:</p>
        <ul>
          <li>–ñ–∏—Å–º–æ–Ω–∏–π —à–∞—Ö—Å–ª–∞—Ä: ${data.individual}</li>
          <li>–Æ—Ä–∏–¥–∏–∫ —à–∞—Ö—Å–ª–∞—Ä: ${data.legal}</li>
          <li>–Å–∑–º–∞: ${data.written}</li>
          <li>–≠–ª–µ–∫—Ç—Ä–æ–Ω: ${data.electronic}</li>
          <li>–û“ì–∑–∞–∫–∏: ${data.oral}</li>
        </ul>
        <hr>
        <h4>–ñ–∞–º–∏ –º—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä: ${data.individual + data.legal + data.written + data.electronic + data.oral}</h4>
      `;
    }

    document.getElementById("regionSelect").addEventListener("change", (e) => {
      loadData(e.target.value);
    });

    window.onload = () => {
      const initialRegion = document.getElementById("regionSelect").value;
      loadData(initialRegion);
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    function calculateTotal() {
      const total = +inputs.individual.value + +inputs.legal.value + +inputs.written.value + +inputs.electronic.value + +inputs.oral.value;
      totalCount.textContent = total;
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á–µ—Ç–∞
    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      // –ó–∞–≥–æ–ª–æ–≤–æ–∫
      doc.setFontSize(16);
      doc.text("–ú—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä –ë—û–π–∏—á–∞ “≤–∏—Å–æ–±–æ—Ç", 20, 20);
      
      // –î–æ–±–∞–≤–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
      doc.setFontSize(12);
      doc.text(`–û–±–ª–∞—Å—Ç—å: ${document.getElementById("regionSelect").value}`, 20, 30);
      doc.text(`–ô–∏–ª: ${document.getElementById("yearSelect").value}`, 20, 40);
      
      // –í—Å—Ç–∞–≤–∏–º —Ç–∞–±–ª–∏—Ü—É —Å –¥–∞–Ω–Ω—ã–º–∏
      doc.text(`–ñ–∏—Å–º–æ–Ω–∏–π —à–∞—Ö—Å–ª–∞—Ä: ${inputs.individual.value}`, 20, 50);
      doc.text(`–Æ—Ä–∏–¥–∏–∫ —à–∞—Ö—Å–ª–∞—Ä: ${inputs.legal.value}`, 20, 60);
      doc.text(`–Å–∑–º–∞: ${inputs.written.value}`, 20, 70);
      doc.text(`–≠–ª–µ–∫—Ç—Ä–æ–Ω: ${inputs.electronic.value}`, 20, 80);
      doc.text(`–û“ì–∑–∞–∫–∏: ${inputs.oral.value}`, 20, 90);
      doc.text(`–ñ–∞–º–∏ –º—É—Ä–æ–∂–∞–∞—Ç–ª–∞—Ä: ${totalCount.textContent}`, 20, 100);
      
      // –î–æ–±–∞–≤–∏–º –≥—Ä–∞—Ñ–∏–∫ –≤ PDF
      const canvas = document.getElementById('chart');
      const imgData = canvas.toDataURL("image/png");
      doc.addImage(imgData, 'PNG', 20, 110, 170, 90); // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
     
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
      doc.save("report.pdf");
    }
  </script>
</body>
</html>
